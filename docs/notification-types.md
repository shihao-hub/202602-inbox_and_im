# 站内信类型说明

## 概述

本文档详细说明了站内信系统支持的各种类型及其使用场景。

## 站内信类型

### 1. system - 系统通知

**说明**: 由系统自动生成的通知，通常涉及账号安全、系统状态等重要信息。

**使用场景**:

- 账号登录提醒（异地登录、设备变更）
- 密码修改通知
- 账号状态变更（激活、冻结）
- 系统维护公告
- 安全警告

**示例**:

```json
{
  "type": "system",
  "title": "异地登录提醒",
  "content": "您的账号于 2025-02-07 10:30 在新设备上登录，如非本人操作请及时修改密码。",
  "priority": 2,
  "action_url": "https://example.com/security"
}
```

**优先级建议**: 通常为 `1`（重要）或 `2`（紧急）

---

### 2. business - 业务通知

**说明**: 与业务流程相关的通知，涉及用户的业务操作和状态变更。

**使用场景**:

- 订单状态更新（待支付、已发货、已完成）
- 审批流程通知（待审批、已通过、已拒绝）
- 业务提醒（即将到期、逾期提醒）
- 任务分配和状态更新
- 交易通知

**示例**:

```json
{
  "type": "business",
  "title": "订单已发货",
  "content": "您的订单 #123456 已发货，预计 3 天内送达。",
  "priority": 1,
  "action_url": "https://example.com/orders/123456"
}
```

**优先级建议**: 通常为 `0`（普通）或 `1`（重要）

---

### 3. reminder - 提醒通知

**说明**: 用于提醒用户即将发生或需要关注的事件。

**使用场景**:

- 会议提醒（会议开始前 15 分钟）
- 日程提醒
- 待办事项提醒
- 截止日期提醒
- 重复性提醒（每日、每周）

**示例**:

```json
{
  "type": "reminder",
  "title": "会议提醒",
  "content": "您有一个会议将于 15 分钟后开始：产品评审会议",
  "priority": 1,
  "action_url": "https://example.com/meetings/123"
}
```

**优先级建议**: 通常为 `1`（重要）

---

### 4. announcement - 公告

**说明**: 管理员发布的面向所有用户或特定用户群组的公告信息。

**使用场景**:

- 产品更新公告
- 功能上线通知
- 活动公告
- 政策变更通知
- 节假日通知

**示例**:

```json
{
  "type": "announcement",
  "title": "系统升级公告",
  "content": "我们将于 2025-02-10 22:00-24:00 进行系统升级，期间服务可能受到影响。",
  "priority": 1,
  "action_url": "https://example.com/announcements/001"
}
```

**优先级建议**: 通常为 `1`（重要）或 `2`（紧急）

---

## 优先级说明

### 0 - 普通

**说明**: 常规通知，不需要用户立即处理。

**适用场景**:

- 一般性业务通知
- 信息推送
- 非紧急的提醒

**展示建议**: 普通样式，无需特殊标记

---

### 1 - 重要

**说明**: 需要用户关注的通知，建议尽快查看。

**适用场景**:

- 订单状态变更
- 会议提醒
- 系统公告

**展示建议**:

- 使用醒目的颜色标记（如蓝色、橙色）
- 在列表中置顶显示
- 显示"重要"标记

---

### 2 - 紧急

**说明**: 需要用户立即处理的通知。

**适用场景**:

- 账号安全警告
- 紧急系统维护
- 高优先级任务

**展示建议**:

- 使用红色等醒目颜色
- 持续显示直到用户确认
- 配合其他提醒方式（如邮件、短信）
- 显示"紧急"标记

---

## 站内信字段说明

### type (类型)

- **必填**: 是
- **类型**: string
- **可选值**: `system`, `business`, `reminder`, `announcement`
- **说明**: 站内信的类型，用于分类和筛选

### title (标题)

- **必填**: 是
- **类型**: string
- **长度**: 1-200 字符
- **说明**: 站内信的简短标题，用于列表展示

### content (内容)

- **必填**: 是
- **类型**: string
- **说明**: 站内信的详细内容，支持纯文本或 Markdown（取决于前端实现）

### action_url (跳转链接)

- **必填**: 否
- **类型**: string
- **长度**: 0-500 字符
- **说明**: 用户点击站内信后跳转的 URL

### priority (优先级)

- **必填**: 是
- **类型**: integer
- **默认值**: 0
- **可选值**: 0, 1, 2
- **说明**: 站内信的优先级，影响展示顺序和样式

### expires_at (过期时间)

- **必填**: 否
- **类型**: datetime (ISO8601)
- **说明**: 站内信的过期时间，过期后可自动归档或隐藏

---

## 使用示例

### 创建系统通知

```bash
curl -X POST "http://localhost:8000/api/v1/admin/notifications" \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{
    "type": "system",
    "title": "密码修改成功",
    "content": "您的密码已成功修改，如非本人操作请联系客服。",
    "priority": 2,
    "action_url": "https://example.com/security"
  }'
```

### 创建业务通知

```bash
curl -X POST "http://localhost:8000/api/v1/admin/notifications" \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{
    "type": "business",
    "title": "订单已发货",
    "content": "您的订单 #123456 已发货",
    "priority": 1,
    "action_url": "https://example.com/orders/123456"
  }'
```

### 创建提醒通知

```bash
curl -X POST "http://localhost:8000/api/v1/admin/notifications" \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{
    "type": "reminder",
    "title": "会议提醒",
    "content": "产品评审会议将于 15 分钟后开始",
    "priority": 1
  }'
```

### 创建公告

```bash
curl -X POST "http://localhost:8000/api/v1/admin/notifications" \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{
    "type": "announcement",
    "title": "春节放假通知",
    "content": "2025年春节放假安排：2月9日-2月17日放假，2月18日正常上班",
    "priority": 1,
    "expires_at": "2025-02-18T00:00:00Z"
  }'
```

---

## 前端展示建议

### 列表展示

```
┌─────────────────────────────────────────┐
│ 🔴 紧急  异地登录提醒          [2分钟前] │
│ 您的账号在新设备上登录...               │
└─────────────────────────────────────────┘
┌─────────────────────────────────────────┐
│ ⭐ 重要  订单已发货            [1小时前] │
│ 您的订单 #123456 已发货...              │
└─────────────────────────────────────────┘
┌─────────────────────────────────────────┐
│ ℹ️ 普通   系统升级公告         [昨天]   │
│ 我们将于 2月10日进行系统升级...         │
└─────────────────────────────────────────┘
```

### 未读标记

- 未读站内信使用粗体或特殊背景
- 显示未读数量徽章
- 点击后自动标记为已读

### 优先级样式

| 优先级 | 标记  | 颜色    | 图标                 |
| --- | --- | ----- | ------------------ |
| 普通  | ℹ️  | 灰色/蓝色 | info-circle        |
| 重要  | ⭐   | 橙色    | star               |
| 紧急  | 🔴  | 红色    | exclamation-circle |

---

## 最佳实践

### 1. 站内信内容设计

- **标题**: 简洁明了，直接说明主题
- **内容**: 提供足够的信息，但避免冗长
- **行动**: 明确用户需要做什么（如果有）
- **链接**: 提供相关的操作链接（action_url）

### 2. 发送频率控制

- 避免短时间内发送大量站内信
- 相同类型的站内信可以考虑合并
- 提供站内信偏好设置（未来功能）

### 3. 过期时间设置

- 临时性通知设置过期时间（如活动公告）
- 长期有效通知不设置过期时间
- 过期后自动归档或降低优先级

### 4. 多渠道通知

- 紧急通知配合邮件或短信发送
- 重要通知提供邮件备份
- 允许用户自定义通知偏好

---

## 扩展建议

### 未来功能

1. **消息模板系统**
   
   - 预定义常用消息模板
   - 支持变量替换（如用户名、订单号）
   - 多语言支持

2. **用户偏好设置**
   
   - 允许用户选择接收哪些类型的通知
   - 允许用户设置通知方式（站内信、邮件、短信）
   - 免打扰时段设置

3. **消息聚合**
   
   - 相似消息的聚合显示
   - 按时间或类型分组
   - 消息摘要功能

4. **统计分析**
   
   - 发送成功率统计
   - 阅读率统计
   - 用户行为分析

---

## 相关文档

- [API 文档](./api-documentation.md)
- [数据库设计文档](./database-schema.md)
- [README](../README.md)
